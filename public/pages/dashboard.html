<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#060e21">
    <title>Kita-kita Banking Dashboard</title>
    <link rel="stylesheet" href="../src/index.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        // Import Firebase auth and make it globally available
        import { getAuth } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { firebaseConfig } from "../js/config.js";

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        window.auth = getAuth(app);

        // Create a loading overlay
        window.addEventListener('DOMContentLoaded', () => {
            // Create loading overlay if it doesn't exist
            if (!document.getElementById('loading-overlay')) {
                const loadingOverlay = document.createElement('div');
                loadingOverlay.id = 'loading-overlay';
                loadingOverlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: #060e21;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                    transition: opacity 0.5s ease;
                `;

                const spinner = document.createElement('div');
                spinner.className = 'loading-spinner';
                spinner.style.cssText = `
                    width: 50px;
                    height: 50px;
                    border: 3px solid rgba(16, 223, 111, 0.3);
                    border-radius: 50%;
                    border-top-color: #10df6f;
                    animation: spin 1s linear infinite;
                    margin-bottom: 20px;
                `;

                const loadingText = document.createElement('p');
                loadingText.textContent = 'Loading your dashboard...';
                loadingText.style.cssText = `
                    color: #fff;
                    font-family: 'Poppins', sans-serif;
                `;

                const style = document.createElement('style');
                style.textContent = `
                    @keyframes spin {
                        to { transform: rotate(360deg); }
                    }
                `;

                loadingOverlay.appendChild(spinner);
                loadingOverlay.appendChild(loadingText);
                document.head.appendChild(style);
                document.body.appendChild(loadingOverlay);
            }
        });

        // Listen for auth state changes
        window.auth.onAuthStateChanged(user => {
            if (user) {
                // User is logged in, load profile data
                const loadingOverlay = document.getElementById('loading-overlay');

                // Try to load profile data in the background
                if (typeof loadFinancialProfileData === 'function') {
                    loadFinancialProfileData().catch(err => console.error('Error loading financial data:', err));
                }
                if (typeof loadPersonalProfileData === 'function') {
                    loadPersonalProfileData().catch(err => console.error('Error loading personal data:', err));
                }

                // Set a very short maximum loading time (2 seconds)
                setTimeout(() => {
                    if (loadingOverlay) {
                        loadingOverlay.style.opacity = '0';
                        setTimeout(() => {
                            loadingOverlay.remove();
                        }, 300);
                    }
                }, 2000); // Hide overlay after 2 seconds max

            } else {
                // User is not logged in, redirect to login
                window.location.href = "login.html";
            }
        });
    </script>
    <script type="module" src="../js/dashboard.js" defer></script>
    <link rel="stylesheet" href="../css/theme.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="../css/chatbot.css">
    <style>
        /* Transaction-specific styles that are not in the CSS file */
        .delete-transaction-btn {
            background: rgba(233, 109, 31, 0.2);
            transform: scale(1.1);
        }

        /* Mobile responsiveness handled by theme.css */

        .transactions-table td.actions {
            width: 50px;
            text-align: center;
        }

        .transactions-table tr:hover .delete-transaction-btn {
            opacity: 1;
        }

        /* Transaction amount styling */
        .transaction-type {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .transaction-type.income {
            background: rgba(16, 223, 111, 0.15);
            color: var(--primary-green);
        }

        .transaction-type.expense {
            background: rgba(233, 109, 31, 0.15);
            color: var(--secondary-orange);
        }

        /* Form field styling */
        select option {
            background-color: #121c2e;
            color: white;
        }

        select {
            background-color: #121c2e;
            color: white;
            border: 1px solid var(--glass-border);
        }

        /* Fix for modal horizontal scrollbars */
        .modal-content,
        .modal-content.wider-modal,
        .modal-body {
            overflow-x: hidden !important;
            max-width: 100% !important;
        }

        /* Control width of all children inside modal content */
        .modal-content>div,
        .modal-content>div>div,
        .modal-body>div {
            max-width: 100% !important;
            box-sizing: border-box !important;
        }

        /* Custom scrollbar styling */
        .modal-content,
        .wider-modal,
        .modal-body {
            /* Firefox scrollbar styling */
            scrollbar-width: thin;
            scrollbar-color: rgba(16, 223, 111, 0.5) rgba(30, 30, 30, 0.1);

            /* Smooth scrolling */
            scroll-behavior: smooth;
        }

        /* Webkit scrollbar styling (Chrome, Safari, Edge) */
        .modal-content::-webkit-scrollbar,
        .wider-modal::-webkit-scrollbar,
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track,
        .wider-modal::-webkit-scrollbar-track,
        .modal-body::-webkit-scrollbar-track {
            background: rgba(30, 30, 30, 0.1);
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb,
        .wider-modal::-webkit-scrollbar-thumb,
        .modal-body::-webkit-scrollbar-thumb {
            background: rgba(16, 223, 111, 0.5);
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .modal-content::-webkit-scrollbar-thumb:hover,
        .wider-modal::-webkit-scrollbar-thumb:hover,
        .modal-body::-webkit-scrollbar-thumb:hover {
            background: rgba(16, 223, 111, 0.8);
        }

        /* Hidden link for accessibility */
        .hidden-link {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            z-index: 1;
            cursor: pointer;
        }

        /* Enhanced chatbot styling */
        .chatbot-toggle {
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-orange));
            box-shadow: 0 15px 40px rgba(16, 223, 111, 0.5);
            backdrop-filter: blur(15px);
        }

        .chatbot-window {
            background: rgba(6, 14, 33, 0.98);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
        }

        /* Enhanced AI Agents Section */
        .ai-agents-section {
            margin: 2rem 1rem;
        }

        .section-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .section-header h2 {
            color: #fff;
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .section-header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            margin: 0;
        }

        .ai-agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .ai-agent-card {
            background: rgba(18, 28, 46, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .ai-agent-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary-green), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .ai-agent-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(16, 223, 111, 0.2);
            border-color: rgba(16, 223, 111, 0.3);
        }

        .ai-agent-card:hover::before {
            opacity: 1;
        }

        .agent-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .agent-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .agent-icon::before {
            content: '';
            position: absolute;
            inset: 0;
            background: inherit;
            opacity: 0.1;
            border-radius: inherit;
        }

        .agent-icon.ipon-coach {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
        }

        .agent-icon.gastos-guardian {
            background: linear-gradient(135deg, #FFC107, #FFD54F);
        }

        .agent-icon.pera-planner {
            background: linear-gradient(135deg, #9C27B0, #BA68C8);
        }

        .agent-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        .status-text {
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .agent-card-body h3 {
            color: #fff;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .agent-card-body p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .agent-features {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .feature-tag {
            background: rgba(16, 223, 111, 0.1);
            color: var(--primary-green);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            border: 1px solid rgba(16, 223, 111, 0.2);
        }

        .agent-card-footer {
            margin-top: auto;
        }

        .agent-cta-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary-green), #0ea5e9);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .agent-cta-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #0ea5e9, var(--primary-green));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .agent-cta-btn:hover::before {
            opacity: 1;
        }

        .agent-cta-btn span,
        .agent-cta-btn i {
            position: relative;
            z-index: 1;
        }

        .agent-cta-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 223, 111, 0.3);
        }

        .agent-cta-btn i {
            transition: transform 0.3s ease;
        }

        .agent-cta-btn:hover i {
            transform: translateX(4px);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .ai-agents-section {
                margin: 1rem 0.5rem;
            }

            .ai-agents-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .section-header h2 {
                font-size: 1.5rem;
            }

            .ai-agent-card {
                padding: 1.25rem;
            }

            .agent-icon {
                width: 50px;
                height: 50px;
                font-size: 1.25rem;
            }
        }

        /* Enhanced Financial Health Widget Styles */
        .financial-health-container {
            background: rgba(18, 28, 46, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 0;
            overflow: hidden;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .financial-health-container.loaded {
            opacity: 1;
            transform: translateY(0);
        }

        /* Header Section */
        .financial-health-header {
            background: linear-gradient(135deg, rgba(16, 223, 111, 0.1), rgba(14, 165, 233, 0.1));
            padding: 1.5rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #fff;
        }

        .header-title i {
            color: var(--primary-green);
            font-size: 1.5rem;
        }

        .modern-refresh {
            background: rgba(16, 223, 111, 0.1);
            border: 1px solid rgba(16, 223, 111, 0.3);
            color: var(--primary-green);
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .modern-refresh:hover {
            background: rgba(16, 223, 111, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 223, 111, 0.3);
        }

        .modern-refresh:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .last-updated {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Score Section */
        .financial-health-score-section {
            padding: 2rem 1.5rem;
        }

        .score-container {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .score-circle {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-background {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 8;
        }

        .progress-ring-progress {
            fill: none;
            stroke: var(--color);
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 314;
            stroke-dashoffset: calc(314 - (314 * var(--progress)) / 100);
            transition: stroke-dashoffset 2s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 0 8px var(--color));
        }

        .score-content {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .score-number {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
        }

        .score-max {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: -0.25rem;
        }

        .score-info {
            flex: 1;
        }

        .score-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .status-emoji {
            font-size: 1.5rem;
        }

        .status-text {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .score-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            line-height: 1.5;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding: 0 1.5rem 1.5rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .stat-icon.income {
            background: rgba(16, 223, 111, 0.2);
            color: var(--primary-green);
        }

        .stat-icon.expense {
            background: rgba(233, 109, 31, 0.2);
            color: var(--secondary-orange);
        }

        .stat-icon.balance {
            background: rgba(14, 165, 233, 0.2);
            color: #0ea5e9;
        }

        .stat-content {
            flex: 1;
        }

        .stat-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
        }

        .stat-value.positive {
            color: var(--primary-green);
        }

        .stat-value.negative {
            color: var(--secondary-orange);
        }

        /* Insights Section */
        .insights-section, .suggestions-section {
            padding: 1.5rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .suggestions-section:last-child {
            border-bottom: none;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-header h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #fff;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .insights-count, .suggestions-count {
            background: rgba(16, 223, 111, 0.2);
            color: var(--primary-green);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .insights-grid {
            display: grid;
            gap: 1rem;
        }

        .insight-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.25rem;
            opacity: 0;
            transform: translateY(20px);
            animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            transition: all 0.3s ease;
        }

        .insight-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .insight-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .insight-icon.positive {
            background: rgba(16, 223, 111, 0.2);
            color: var(--primary-green);
        }

        .insight-icon.negative {
            background: rgba(233, 109, 31, 0.2);
            color: var(--secondary-orange);
        }

        .insight-icon.warning {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .insight-icon.opportunity {
            background: rgba(14, 165, 233, 0.2);
            color: #0ea5e9;
        }

        .insight-icon.neutral {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }

        .insight-type-label {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: rgba(255, 255, 255, 0.8);
        }

        .insight-content {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
            font-size: 0.95rem;
        }

        /* Suggestions Section */
        .suggestions-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .suggestion-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.25rem;
            opacity: 0;
            transform: translateY(20px);
            animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            transition: all 0.3s ease;
        }

        .suggestion-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .suggestion-number {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary-green), #0ea5e9);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .suggestion-content {
            flex: 1;
        }

        .suggestion-content p {
            margin: 0;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            background: rgba(16, 223, 111, 0.1);
            border: 1px solid rgba(16, 223, 111, 0.3);
            color: var(--primary-green);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .action-btn:hover {
            background: rgba(16, 223, 111, 0.2);
            transform: translateX(4px);
        }

        /* Footer */
        .financial-health-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.02);
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .powered-by, .next-update {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Animations */
        @keyframes slideInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design for Financial Health Widget */
        @media (max-width: 768px) {
            .score-container {
                flex-direction: column;
                text-align: center;
                gap: 1.5rem;
            }

            .quick-stats {
                grid-template-columns: 1fr;
            }

            .financial-health-header {
                padding: 1rem;
            }

            .financial-health-score-section {
                padding: 1.5rem 1rem;
            }

            .insights-section, .suggestions-section {
                padding: 1rem;
            }

            .financial-health-footer {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
        }
    </style>
</head>

<body>
    <!-- Light Effects -->
    <div class="light light-1"></div>
    <div class="light light-2"></div>
    <div class="light light-3"></div>

    <div class="dashboard-layout">
        <!-- Enhanced Header Navigation -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-coins" style="color: var(--primary-green); font-size: 1.5rem;"></i>
                <span class="logo-text">Kita-kita</span>
            </div>
            <nav class="header-nav">
                <ul class="header-nav-items">
                    <li><a href="dashboard.html" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="transactions.html"><i class="fas fa-exchange-alt"></i> Transactions</a></li>
                    <li><a href="accounts.html"><i class="fas fa-wallet"></i> Accounts</a></li>
                    <li><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
                    <li><a href="../index.html"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="#" id="logout-button" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </nav>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Home Page (Dashboard) -->
            <div class="page-content" id="dashboard-page">
                <!-- Welcome Banner with floating animation -->
                <div class="welcome-banner">
                    <div class="welcome-content">
                        <h1>Welcome, <span id="welcomeUsername">Loading...</span>!</h1>
                        <p>Your financial dashboard is ready.</p>
                    </div>
                    </div>
                </div>
                <script>
                    // Immediately set a default name from auth
                    window.addEventListener('DOMContentLoaded', () => {
                        window.auth.onAuthStateChanged(user => {
                            if (user) {
                                const welcomeElement = document.getElementById('welcomeUsername');
                                if (welcomeElement) {
                                    if (user.displayName) {
                                        const firstName = user.displayName.split(' ')[0];
                                        welcomeElement.textContent = firstName;
                                    } else if (user.email) {
                                        const emailName = user.email.split('@')[0];
                                        welcomeElement.textContent = emailName;
                                    } else {
                                        welcomeElement.textContent = 'User';
                                    }
                                }
                            }
                        });
                    });
                </script>

                <!-- AI Agents Section -->
                <section class="ai-agents-section">
                    <div class="section-header">
                        <h2><i class="fas fa-robot"></i> Your AI Financial Assistants</h2>
                        <p>Choose your specialized AI coach to help with your financial journey</p>
                    </div>
                    
                    <div class="ai-agents-grid">
                        <!-- Ipon Coach Card -->
                        <div class="ai-agent-card" data-agent="iponCoach">
                            <div class="agent-card-header">
                                <div class="agent-icon ipon-coach">
                                    <i class="fas fa-piggy-bank"></i>
                                </div>
                                <div class="agent-status">
                                    <span class="status-dot active"></span>
                                    <span class="status-text">Ready</span>
                                </div>
                            </div>
                            <div class="agent-card-body">
                                <h3>Ipon Coach</h3>
                                <p>Your personal savings mentor with Filipino wisdom and practical tips for building wealth.</p>
                                <div class="agent-features">
                                    <span class="feature-tag">üí∞ Savings Goals</span>
                                    <span class="feature-tag">üìà Growth Tips</span>
                                    <span class="feature-tag">üéØ Challenges</span>
                                </div>
                            </div>
                            <div class="agent-card-footer">
                                <button class="agent-cta-btn">
                                    <span>Start Coaching</span>
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Gastos Guardian Card -->
                        <div class="ai-agent-card" data-agent="gastosGuardian">
                            <div class="agent-card-header">
                                <div class="agent-icon gastos-guardian">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="agent-status">
                                    <span class="status-dot active"></span>
                                    <span class="status-text">Ready</span>
                                </div>
                            </div>
                            <div class="agent-card-body">
                                <h3>Gastos Guardian</h3>
                                <p>Smart expense tracking with Filipino-centric insights to help you spend wisely.</p>
                                <div class="agent-features">
                                    <span class="feature-tag">üìä Expense Analysis</span>
                                    <span class="feature-tag">üí° Tipid Tips</span>
                                    <span class="feature-tag">üîç Spending Leaks</span>
                                </div>
                            </div>
                            <div class="agent-card-footer">
                                <button class="agent-cta-btn">
                                    <span>Analyze Expenses</span>
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Pera Planner Card -->
                        <div class="ai-agent-card" data-agent="peraPlanner">
                            <div class="agent-card-header">
                                <div class="agent-icon pera-planner">
                                    <i class="fas fa-map-marked-alt"></i>
                                </div>
                                <div class="agent-status">
                                    <span class="status-dot active"></span>
                                    <span class="status-text">Ready</span>
                                </div>
                            </div>
                            <div class="agent-card-body">
                                <h3>Pera Planner</h3>
                                <p>Long-term financial roadmaps tailored for Filipino life stages and goals.</p>
                                <div class="agent-features">
                                    <span class="feature-tag">üó∫Ô∏è Financial Roadmap</span>
                                    <span class="feature-tag">üìà Investment Guide</span>
                                    <span class="feature-tag">‚öñÔ∏è Life Balance</span>
                                </div>
                            </div>
                            <div class="agent-card-footer">
                                <button class="agent-cta-btn">
                                    <span>Plan Future</span>
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <div class="widgets-container">
                    <!-- Financial Health Widget -->
                    <div class="dashboard-card financial-health-card">
                        <h2><i class="fas fa-heartbeat"></i> Financial Health</h2>
                        <div class="financial-health-content" id="financial-health-content">
                            <div class="loading-state">
                                <div class="pulse-loader"></div>
                                <p>Analyzing your financial data...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page-content" id="banks-page" style="display: none;">
                <div class="page-header">
                    <h1>Account Balances</h1>
                    <button id="add-bank-button" class="primary-button" style="display: none;">
                        <i class="fas fa-plus"></i> Add New Account
                    </button>
                </div>

                <!-- Total Balance Summary at the top -->
                <div class="balance-summary-container">
                    <div class="balance-summary-content">
                        <div class="summary-item">
                            <span class="summary-label">Total Balance</span>
                            <span class="summary-value" id="total-balance-amount">‚Ç±0.00</span>
                        </div>
                        <div class="summary-divider"></div>
                        <div class="summary-item">
                            <span class="summary-label">Total Accounts</span>
                            <span class="summary-value" id="total-accounts">0</span>
                        </div>
                    </div>
                </div>

                <!-- Bank cards grid -->
                <div class="bank-cards-grid" style="display: none;">
                    <!-- Bank cards will be dynamically added here -->
                </div>

                <!-- Empty state message for bank cards -->
                <div id="banks-empty-state" class="empty-state-container" style="text-align: center; padding: 2rem;">
                    <div class="empty-state-content">
                        <i class="fas fa-university empty-state-icon"
                            style="font-size: 3rem; color: rgba(255, 255, 255, 0.3);"></i>
                        <h3>No accounts added yet</h3>
                        <p class="empty-state-subtitle">Add your first account to start tracking your finances</p>
                        <button id="empty-add-bank-button" class="action-button" style="margin-top: 1rem;">
                            <i class="fas fa-plus"></i> Add Account
                        </button>
                    </div>
                </div>

                <!-- Add Bank Modal - Enhanced version -->
                <div id="add-bank-modal" class="modal">
                    <div class="modal-content wider-modal">
                        <div class="modal-header">
                            <h2><i class="fas fa-university"></i> Add New Account</h2>
                            <button class="modal-close-btn" id="close-add-bank">√ó</button>
                        </div>
                        <form id="add-bank-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Account Type</label>
                                    <select id="account-type">
                                        <option value="bank">Bank Account</option>
                                        <option value="ewallet">E-Wallet</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Currency</label>
                                    <select id="currency" name="currency">
                                        <option value="PHP">PHP (Philippine Peso)</option>
                                    </select>
                                </div>
                            </div>

                            <div id="bank-fields">
                                <div class="form-group">
                                    <label>Bank Name</label>
                                    <input type="text" id="bank-name">
                                </div>
                            </div>

                            <div id="ewallet-fields" style="display: none;">
                                <div class="form-group">
                                    <label>E-Wallet Provider</label>
                                    <select id="ewallet-provider">
                                        <option value="paypal">PayPal</option>
                                        <option value="gcash">GCash</option>
                                        <option value="paymaya">PayMaya</option>
                                        <option value="seabank">SeaBank</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group" id="other-provider-field" style="display: none;">
                                    <label>Specify Provider</label>
                                    <input type="text" id="other-provider">
                                </div>
                            </div>

                            <div class="form-group">
                                <label id="number-label">Card Number</label>
                                <input type="text" id="card-number">
                            </div>
                            <div class="form-group">
                                <label>Name on Card/Account</label>
                                <input type="text" id="card-name">
                            </div>
                            <div class="form-group">
                                <label>Current Balance</label>
                                <div class="currency-input-container">
                                    <span id="currency-symbol">‚Ç±</span>
                                    <input type="number" id="balance" step="0.01">
                                </div>
                            </div>
                            <div class="modal-actions">
                                <button type="submit" class="action-button">Add Account</button>
                                <button type="button" class="cancel-button" id="cancel-add-bank">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Transaction History Page -->
            <div class="page-content" id="transactions-page" style="display: none;">
                <h1>Transaction History</h1>
                <table class="transactions-table">
                    <thead>
                        <tr>
                            <th>Transaction</th>
                            <th>Amount</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Channel</th>
                            <th>Category</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-table-body">
                        <!-- Transactions will be dynamically loaded -->
                    </tbody>
                </table>

                <!-- Empty state message -->
                <div id="transactions-empty-state" class="empty-state-container">
                    <p>No transaction history available</p>
                </div>

                <!-- Add Transaction Button -->
                <button id="add-transaction-button" class="floating-action-button">
                    <i class="fas fa-plus"></i> Add Transaction
                </button>

                <!-- Add Transaction Modal -->
                <div id="add-transaction-modal" class="modal">
                    <div class="modal-content wider-modal">
                        <div class="modal-header">
                            <h2><i class="fas fa-exchange-alt"></i> Add New Transaction</h2>
                            <button class="modal-close-btn" id="close-add-transaction">√ó</button>
                        </div>
                        <form id="add-transaction-form">
                            <div class="form-group">
                                <label>Transaction Name</label>
                                <input type="text" id="transaction-name" placeholder="E.g., Grocery Store, Utility Bill"
                                    required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Type</label>
                                    <select id="transaction-type" required>
                                        <option value="expense">Expense</option>
                                        <option value="income">Income</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>Amount</label>
                                    <div class="currency-input-container">
                                        <span id="transaction-currency-symbol">‚Ç±</span>
                                        <input type="number" id="transaction-amount" step="0.01" required>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Account</label>
                                <select id="transaction-account" required>
                                    <option value="">-- Select Account --</option>
                                    <!-- Account options will be populated dynamically -->
                                </select>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date</label>
                                    <input type="date" id="transaction-date" required>
                                </div>

                                <div class="form-group">
                                    <label>Time</label>
                                    <input type="time" id="transaction-time">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Channel</label>
                                    <select id="transaction-channel" required>
                                        <option value="online">Online</option>
                                        <option value="in-store">In Store</option>
                                        <option value="transfer">Bank Transfer</option>
                                        <option value="mobile">Mobile</option>
                                        <option value="atm">ATM</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>Category</label>
                                    <select id="transaction-category" required>
                                        <option value="food">Food & Drink</option>
                                        <option value="shopping">Shopping</option>
                                        <option value="bills">Bills & Utilities</option>
                                        <option value="transportation">Transportation</option>
                                        <option value="entertainment">Entertainment</option>
                                        <option value="housing">Housing</option>
                                        <option value="health">Health</option>
                                        <option value="education">Education</option>
                                        <option value="income">Income</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Notes (Optional)</label>
                                <textarea id="transaction-notes" rows="2"></textarea>
                            </div>

                            <div class="modal-actions">
                                <button type="submit" class="action-button">Add Transaction</button>
                                <button type="button" class="cancel-button" id="cancel-add-transaction">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>


        </main>
    </div>

    <!-- Enhanced Chatbot -->
    <div class="chatbot-container" style="position: fixed; bottom: 2rem; right: 2rem; z-index: 1000;">
        <div class="chatbot-toggle" id="chatbotToggle" style="width: 60px; height: 60px; background: linear-gradient(135deg, #10df6f, #0ea5e9); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 8px 25px rgba(16, 223, 111, 0.4); transition: all 0.3s ease; position: relative; border: none;">
            <div class="bot-icon" style="color: white; font-size: 1.5rem; z-index: 2; position: relative;"><i class="fas fa-robot"></i></div>
            <div class="pulse-ring" style="position: absolute; width: 100%; height: 100%; border: 2px solid #10df6f; border-radius: 50%; animation: pulse-ring 2s infinite; opacity: 0;"></div>
        </div>

        <div class="chatbot-window" id="chatbotWindow" style="position: absolute; bottom: 80px; right: 0; width: 380px; height: 500px; background: rgba(6, 14, 33, 0.95); backdrop-filter: blur(30px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5); display: none; flex-direction: column; overflow: hidden; opacity: 0; transform: translateY(20px) scale(0.95); transition: all 0.4s ease;">
            <div class="chatbot-header" style="background: linear-gradient(135deg, rgba(16, 223, 111, 0.1), rgba(14, 165, 233, 0.1)); padding: 1rem 1.5rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: space-between; align-items: center;">
                <h3 style="color: #fff; font-size: 1.1rem; font-weight: 600; margin: 0;">ü§ñ AI Financial Assistant</h3>
                <button class="close-btn" id="closeChatbot" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: rgba(255, 255, 255, 0.8); width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; font-size: 1.2rem;">√ó</button>
            </div>
            <div class="chat-messages" id="chatMessages" style="flex: 1; padding: 1rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem;">
                <!-- Messages will be dynamically added here -->
            </div>
            <div class="chat-input" style="padding: 1rem 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1); background: rgba(255, 255, 255, 0.02); display: flex; gap: 0.75rem; align-items: center;">
                <input type="text" id="userInput" placeholder="Ask me about your finances..." autocomplete="off" style="flex: 1; background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 8px; padding: 0.75rem 1rem; color: #fff; font-size: 0.9rem;">
                <button id="sendMessage" style="background: linear-gradient(135deg, #10df6f, #0ea5e9); border: none; color: white; padding: 0.75rem 1.25rem; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 0.9rem;"><span>Send</span></button>
            </div>
        </div>
    </div>
    
    <style>
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(1.4); opacity: 0; }
        }
        
        .chatbot-toggle:hover {
            transform: translateY(-4px) scale(1.05) !important;
            box-shadow: 0 15px 40px rgba(16, 223, 111, 0.6) !important;
        }
        
        .close-btn:hover {
            background: rgba(233, 109, 31, 0.2) !important;
            color: #e96d1f !important;
            transform: rotate(90deg) !important;
        }
        
        .chat-input input:focus {
            outline: none;
            border-color: #10df6f !important;
            box-shadow: 0 0 0 2px rgba(16, 223, 111, 0.2) !important;
        }
        
        .chat-input button:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 20px rgba(16, 223, 111, 0.4) !important;
        }
        
        .message {
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            font-size: 0.9rem;
            line-height: 1.4;
            animation: messageSlideIn 0.4s ease;
        }
        
        .bot-message {
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.9);
            align-self: flex-start;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom-left-radius: 4px;
        }
        
        .user-message {
            background: linear-gradient(135deg, #10df6f, #0ea5e9);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        
        @keyframes messageSlideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .chatbot-container {
                bottom: 1rem !important;
                right: 1rem !important;
            }
            .chatbot-window {
                width: calc(100vw - 2rem) !important;
                max-width: 350px !important;
                right: -1rem !important;
            }
        }
    </style>

    <!-- Add this new modal for transaction details -->
    <div id="transaction-details-modal" class="modal">
        <div class="modal-content wider-modal">
            <div class="modal-header">
                <h2><i class="fas fa-file-invoice"></i> Transaction Details</h2>
                <button class="modal-close-btn"
                    onclick="document.getElementById('transaction-details-modal').style.display='none'">√ó</button>
            </div>

            <div class="transaction-details-grid">
                <div class="detail-item">
                    <div class="detail-label">Transaction Name</div>
                    <div class="detail-value" id="view-transaction-name"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Amount</div>
                    <div class="detail-value" id="view-transaction-amount"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Account</div>
                    <div class="detail-value" id="view-transaction-account">N/A</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Date & Time</div>
                    <div class="detail-value" id="view-transaction-date"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Channel</div>
                    <div class="detail-value" id="view-transaction-channel"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Category</div>
                    <div class="detail-value" id="view-transaction-category"></div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Type</div>
                    <div class="detail-value" id="view-transaction-status"></div>
                </div>
            </div>

            <div class="detail-item" style="margin-bottom: 1.5rem;">
                <div class="detail-label">Notes</div>
                <div class="detail-value" id="view-transaction-notes"></div>
            </div>

            <div class="modal-actions">
                <button class="action-button" onclick="editTransaction(this.closest('.modal').dataset.transactionId)">
                    <i class="fas fa-edit"></i> Edit Transaction
                </button>
                <button class="cancel-button"
                    onclick="document.getElementById('transaction-details-modal').style.display='none'">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Add these modal containers -->
    <!-- Removed Kita Companions-related modals -->

    <!-- Verification Modal -->
    <div id="verification-modal" class="modal">
        // ... copy verification modal code from profile.html ...
    </div>

    <!-- Password Setup Modal -->
    <div id="password-setup-modal" class="modal">
        // ... copy password setup modal code from profile.html ...
    </div>

    <!-- Removed Kita Companions-related modals -->

    <script type="module" src="../js/financialHealth.js"></script>
    <script type="module" src="../js/dashboardChatbot.js"></script>
    
    <!-- Debug script for chatbot -->
    <script>
        // Debug chatbot loading
        console.log('üîç Dashboard HTML loaded, checking chatbot elements...');
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç DOM loaded, checking chatbot elements...');
            
            const chatbotToggle = document.getElementById('chatbotToggle');
            const chatbotWindow = document.getElementById('chatbotWindow');
            const chatMessages = document.getElementById('chatMessages');
            const userInput = document.getElementById('userInput');
            const sendMessage = document.getElementById('sendMessage');
            const closeChatbot = document.getElementById('closeChatbot');
            
            console.log('üîç Chatbot elements check:', {
                chatbotToggle: !!chatbotToggle,
                chatbotWindow: !!chatbotWindow,
                chatMessages: !!chatMessages,
                userInput: !!userInput,
                sendMessage: !!sendMessage,
                closeChatbot: !!closeChatbot
            });
            
            if (chatbotToggle) {
                console.log('‚úÖ Chatbot toggle found, adding SINGLE click handler...');
                
                // Remove any existing event listeners first
                chatbotToggle.replaceWith(chatbotToggle.cloneNode(true));
                const newChatbotToggle = document.getElementById('chatbotToggle');
                
                // Add a flag to prevent rapid clicking
                let isToggling = false;
                let chatbotJustOpened = false;
                
                newChatbotToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Prevent rapid clicking
                    if (isToggling) {
                        console.log('üö´ Preventing rapid clicking');
                        return;
                    }
                    
                    isToggling = true;
                    console.log('üñ±Ô∏è Chatbot toggle clicked (SINGLE handler)');
                    
                    if (chatbotWindow) {
                        const isVisible = chatbotWindow.style.display === 'flex' || 
                                        chatbotWindow.style.display === 'block' ||
                                        chatbotWindow.classList.contains('active');
                        console.log('Current visibility:', isVisible);
                        
                        if (!isVisible) {
                            console.log('Opening chatbot...');
                            chatbotJustOpened = true;
                            
                            chatbotWindow.style.display = 'flex';
                            chatbotWindow.classList.add('active');
                            chatbotWindow.style.opacity = '1';
                            chatbotWindow.style.transform = 'translateY(0) scale(1)';
                            chatbotWindow.style.visibility = 'visible';
                            console.log('‚úÖ Chatbot opened');
                            
                            // Add a simple welcome message if empty
                            if (chatMessages && chatMessages.children.length === 0) {
                                const welcomeMsg = document.createElement('div');
                                welcomeMsg.className = 'message bot-message';
                                welcomeMsg.innerHTML = '<div class="message-content">Hello! üëã I\'m your AI financial assistant. How can I help you today?</div>';
                                chatMessages.appendChild(welcomeMsg);
                            }
                            
                            // Reset the flag after a delay to prevent immediate closure
                            setTimeout(() => {
                                chatbotJustOpened = false;
                                console.log('üîì Chatbot can now be closed by outside clicks');
                            }, 500);
                            
                        } else {
                            console.log('Closing chatbot...');
                            chatbotWindow.classList.remove('active');
                            chatbotWindow.style.opacity = '0';
                            chatbotWindow.style.transform = 'translateY(20px) scale(0.95)';
                            setTimeout(() => {
                                chatbotWindow.style.display = 'none';
                                chatbotWindow.style.visibility = 'hidden';
                            }, 400);
                            console.log('‚úÖ Chatbot closed');
                        }
                    } else {
                        console.error('‚ùå Chatbot window not found!');
                    }
                    
                    // Reset toggle flag
                    setTimeout(() => {
                        isToggling = false;
                    }, 100);
                });
                
                // Add click outside to close (with protection for just opened)
                document.addEventListener('click', function(e) {
                    if (chatbotJustOpened) {
                        console.log('üö´ Preventing immediate closure - chatbot just opened');
                        return;
                    }
                    
                    const chatbotContainer = document.querySelector('.chatbot-container');
                    if (chatbotContainer && !chatbotContainer.contains(e.target)) {
                        if (chatbotWindow && chatbotWindow.classList.contains('active')) {
                            console.log('üñ±Ô∏è Clicking outside chatbot - closing');
                            chatbotWindow.classList.remove('active');
                            chatbotWindow.style.opacity = '0';
                            chatbotWindow.style.transform = 'translateY(20px) scale(0.95)';
                            setTimeout(() => {
                                chatbotWindow.style.display = 'none';
                                chatbotWindow.style.visibility = 'hidden';
                            }, 400);
                        }
                    }
                });
                
                console.log('‚úÖ SINGLE chatbot handler added');
            } else {
                console.error('‚ùå Chatbot toggle not found!');
            }
            
            // Check if dashboardChatbot.js loaded
            setTimeout(() => {
                if (window.testChatbotAI) {
                    console.log('‚úÖ dashboardChatbot.js loaded successfully');
                } else {
                    console.error('‚ùå dashboardChatbot.js may not have loaded properly');
                    console.log('üîß Skipping fallback - using main handler only to prevent conflicts');
                }
            }, 2000);
            
            // Add a test function to window for manual testing
            window.openChatbot = function() {
                console.log('üß™ Manual chatbot open test');
                const chatbotWindow = document.getElementById('chatbotWindow');
                if (chatbotWindow) {
                    chatbotWindow.style.display = 'flex';
                    chatbotWindow.style.opacity = '1';
                    chatbotWindow.style.transform = 'translateY(0) scale(1)';
                    chatbotWindow.style.visibility = 'visible';
                    chatbotWindow.classList.add('active');
                    console.log('‚úÖ Chatbot opened manually');
                } else {
                    console.error('‚ùå Chatbot window not found for manual test');
                }
            };
            
            window.closeChatbot = function() {
                console.log('üß™ Manual chatbot close test');
                const chatbotWindow = document.getElementById('chatbotWindow');
                if (chatbotWindow) {
                    chatbotWindow.style.display = 'none';
                    chatbotWindow.style.visibility = 'hidden';
                    chatbotWindow.classList.remove('active');
                    console.log('‚úÖ Chatbot closed manually');
                }
            };
            
            // Add visual feedback for debugging
            window.highlightChatbotButton = function() {
                const toggle = document.getElementById('chatbotToggle');
                if (toggle) {
                    toggle.style.border = '3px solid red';
                    toggle.style.animation = 'none';
                    toggle.style.transform = 'scale(1.2)';
                    console.log('üî¥ Chatbot button highlighted');
                    
                    setTimeout(() => {
                        toggle.style.border = '';
                        toggle.style.transform = '';
                    }, 3000);
                }
            };
        });
    </script>

    <!-- Removed Kita Companions-related script and CSS imports -->

    <script>
        // Function to navigate to agent pages
        function navigateToAgent(agentName) {
            try {
                // Use absolute path from server root
                const agentPath = `/public/agents/${agentName}.html`;
                window.location.href = agentPath;
            } catch (error) {
                console.error("Navigation error:", error);
                // Direct fallback
                window.location = `/public/agents/${agentName}.html`;
            }
        }

        // Ensure logout button works - fallback handler
        document.addEventListener('DOMContentLoaded', function() {
            const logoutButton = document.getElementById('logout-button');
            if (logoutButton) {
                // Remove any existing listeners first
                logoutButton.replaceWith(logoutButton.cloneNode(true));
                const newLogoutButton = document.getElementById('logout-button');
                
                newLogoutButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üîê Logout button clicked');
                    
                    // Clear storage
                    if (typeof secureStorage !== 'undefined' && secureStorage.clearAll) {
                        secureStorage.clearAll();
                    }
                    localStorage.clear();
                    sessionStorage.clear();
                    
                    // Sign out from Firebase
                    if (window.auth) {
                        import("https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js")
                            .then(({ signOut }) => {
                                signOut(window.auth).then(() => {
                                    console.log('‚úÖ Firebase logout successful');
                                    window.location.href = "login.html";
                                }).catch((error) => {
                                    console.error('‚ùå Firebase logout error:', error);
                                    // Force redirect even if there's an error
                                    window.location.href = "login.html";
                                });
                            });
                    } else {
                        // Fallback if Firebase not available
                        console.log('‚ö†Ô∏è Firebase not available, redirecting to login');
                        window.location.href = "login.html";
                    }
                });
                console.log('‚úÖ Fallback logout handler attached');
            } else {
                console.error('‚ùå Logout button not found in DOM');
            }
        });
        
        // Chatbot functionality is now handled by dashboardChatbot.js

        // Add Bank Modal Handlers
        document.getElementById('add-bank-button').addEventListener('click', function () {
            document.getElementById('add-bank-modal').style.display = 'flex';
        });

        // Add event listeners for AI agent cards
        document.addEventListener('DOMContentLoaded', function() {
            // Handle AI agent card clicks
            document.querySelectorAll('.ai-agent-card[data-agent]').forEach(card => {
                card.addEventListener('click', function() {
                    const agentName = this.getAttribute('data-agent');
                    window.location.href = `../agents/${agentName}.html`;
                });
            });
        });

        // Ensure the dashboard page is shown by default
        document.addEventListener('DOMContentLoaded', function() {
            // Hide all pages first
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            // Show the dashboard page
            document.getElementById('dashboard-page').style.display = 'block';
            
            // Set the dashboard link as active
            document.querySelectorAll('.header-nav-items a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === 'dashboard') {
                    link.classList.add('active');
                }
            });
            
            // Handle navigation via data-page attributes (only for dashboard since profile is external now)
            document.querySelectorAll('.header-nav-items a[data-page]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Get the target page
                    const targetPage = this.getAttribute('data-page');
                    
                    // Only handle dashboard page
                    if (targetPage === 'dashboard') {
                        // Hide all pages
                        document.querySelectorAll('.page-content').forEach(page => {
                            page.style.display = 'none';
                        });
                        
                        // Show the target page
                        document.getElementById(`${targetPage}-page`).style.display = 'block';
                        
                        // Update active state in the navigation
                        document.querySelectorAll('.header-nav-items a').forEach(navLink => {
                            navLink.classList.remove('active');
                        });
                        this.classList.add('active');
                    }
                });
            });
            
            // Check if URL has a hash and navigate to that page if it does
            if (window.location.hash) {
                const targetPage = window.location.hash.substring(1); // Remove the # symbol
                const targetPageElement = document.getElementById(`${targetPage}-page`);
                
                if (targetPageElement) {
                    // Hide all pages
                    document.querySelectorAll('.page-content').forEach(page => {
                        page.style.display = 'none';
                    });
                    
                    // Show the target page
                    targetPageElement.style.display = 'block';
                    
                    // Update active state in the navigation
                    document.querySelectorAll('.header-nav-items a').forEach(navLink => {
                        navLink.classList.remove('active');
                        if (navLink.getAttribute('data-page') === targetPage) {
                            navLink.classList.add('active');
                        }
                    });
                }
            }
        });
    </script>
</body>

</html>